<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance Tracker</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    :root {
      --bg: #ffffff;
      --text: #111111;
      --card: #f5f5f5;
    }
    body.dark {
      --bg: #111111;
      --text: #f5f5f5;
      --card: #1c1c1c;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background-color: var(--card);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    #themeToggle {
      border: none;
      background: transparent;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text);
    }
    main {
      display: grid;
      gap: 2rem;
      padding: 2rem;
    }
    .input-section, .chart-container {
      background-color: var(--card);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    form {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    input, select, button {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }
    button[type="submit"] {
      background-color: #111;
      color: white;
      cursor: pointer;
    }
    .charts {
      display: grid;
      gap: 2rem;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
    .popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.5);
    }
    .popup.hidden {
      display: none;
    }
    .popup-content {
      background-color: var(--card);
      padding: 2rem;
      border-radius: 12px;
      text-align: center;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body>
  <header>
    <h1>Finance Tracker</h1>
    <button id="themeToggle">üåô</button>
  </header>

  <main>
    <section class="input-section">
      <h2>Tambah Transaksi</h2>
      <form id="transactionForm">
        <input type="date" id="date" required />
        <input type="text" id="category" placeholder="Kategori" required />
        <input type="number" id="amount" placeholder="Jumlah (Rp)" required />
        <select id="type">
          <option value="income">Pemasukan</option>
          <option value="expense">Pengeluaran</option>
        </select>
        <button type="submit">Tambah</button>
      </form>
    </section>

    <section class="charts">
      <div class="chart-container">
        <h3>Total Pemasukan vs Pengeluaran</h3>
        <canvas id="pieChart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Per Kategori</h3>
        <canvas id="barChart"></canvas>
      </div>
    </section>
  </main>

  <div id="popup" class="popup hidden">
    <div class="popup-content">
      <h2>Ringkasan Mingguan</h2>
      <p id="summaryText"></p>
      <button id="closePopup">Tutup</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('transactionForm');
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    const barCtx = document.getElementById('barChart').getContext('2d');
    const popup = document.getElementById('popup');
    const summaryText = document.getElementById('summaryText');
    const closePopup = document.getElementById('closePopup');
    const themeToggle = document.getElementById('themeToggle');

    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

    form.addEventListener('submit', e => {
      e.preventDefault();
      const data = {
        date: document.getElementById('date').value,
        category: document.getElementById('category').value,
        amount: parseFloat(document.getElementById('amount').value),
        type: document.getElementById('type').value
      };
      transactions.push(data);
      localStorage.setItem('transactions', JSON.stringify(transactions));
      updateCharts();
      showSummary();
      form.reset();
    });

    function updateCharts() {
      const totalIncome = transactions.filter(t => t.type === 'income').reduce((a, b) => a + b.amount, 0);
      const totalExpense = transactions.filter(t => t.type === 'expense').reduce((a, b) => a + b.amount, 0);

      const categories = {};
      transactions.forEach(t => {
        if (!categories[t.category]) categories[t.category] = 0;
        categories[t.category] += t.amount * (t.type === 'expense' ? -1 : 1);
      });

      const barData = {
        labels: Object.keys(categories),
        datasets: [{
          label: 'Saldo per Kategori',
          data: Object.values(categories),
          backgroundColor: '#111'
        }]
      };

      new Chart(pieCtx, {
        type: 'pie',
        data: {
          labels: ['Pemasukan', 'Pengeluaran'],
          datasets: [{
            data: [totalIncome, totalExpense],
            backgroundColor: ['#007bff', '#dc3545']
          }]
        },
        options: { responsive: true }
      });

      new Chart(barCtx, {
        type: 'bar',
        data: barData,
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    }

    function showSummary() {
      const totalIncome = transactions.filter(t => t.type === 'income').reduce((a, b) => a + b.amount, 0);
      const totalExpense = transactions.filter(t => t.type === 'expense').reduce((a, b) => a + b.amount, 0);
      const balance = totalIncome - totalExpense;
      summaryText.textContent = `Pemasukan: Rp${totalIncome.toLocaleString()} | Pengeluaran: Rp${totalExpense.toLocaleString()} | Saldo: Rp${balance.toLocaleString()}`;
      popup.classList.remove('hidden');
    }

    closePopup.addEventListener('click', () => popup.classList.add('hidden'));

    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      themeToggle.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
    });

    updateCharts();
  </script>
</body>
</html>
